import{a as w,b as Ce,c as Me,d as se,e as Se,f as D,g as Ze,h as Ee,i as Pe,j as h,k as et,l as tt,m as at,p as Q}from"./chunk-EHDMBD76.js";import{a as de}from"./chunk-FHIYLMU2.js";import{a as rt}from"./chunk-Z5G4FRMT.js";import{a as W,b as z,c as j,d as H,e as $,f as U,g as Y}from"./chunk-YPKL42CP.js";import{b as q}from"./chunk-UNCZBHKQ.js";import{a as qe,c as K}from"./chunk-6BWY77AY.js";import{b as X,c as J}from"./chunk-O74GTZCS.js";import"./chunk-BPBLZFBA.js";import{a as Ve,b as V,c as Qe,d as le}from"./chunk-T7YOGHYV.js";import{b as oe,c as Xe,d as T}from"./chunk-YLQEISCQ.js";import{$a as We,Ab as je,Ba as p,Bb as S,Ca as k,Eb as He,Fb as ne,Hb as ie,Lc as Je,Oc as A,Pa as Re,Pc as F,Qc as R,R as Ae,Rc as B,S as Fe,Sc as G,Ua as b,Uc as N,Va as Be,Za as Ge,_a as Ne,ab as l,bb as d,cb as g,da as C,fc as $e,gc as Ue,hc as Ye,j as Le,jc as Ke,kc as L,lb as ze,r as Te,wb as c,xb as _,yb as M,zb as I}from"./chunk-KD3HKJA5.js";var Z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var yt=(a,r,t)=>({"green-pill":a,"warning-pill":r,"red-pill":t});function Ct(a,r){if(a&1&&(l(0,"mat-card",8)(1,"mat-card-header",12)(2,"mat-card-title"),c(3,"Recycling Impact"),d(),l(4,"mat-card-subtitle"),c(5),d(),g(6,"span",3),l(7,"div",13)(8,"mat-icon",14),c(9),d(),l(10,"span"),c(11),d()()(),g(12,"mat-divider"),l(13,"mat-card-content",15)(14,"div",16)(15,"div",17)(16,"div",18),g(17,"mat-icon",19),l(18,"span"),c(19,"Bin Level"),d()(),l(20,"span",20),c(21),d()(),l(22,"div",17)(23,"div",18),g(24,"mat-icon",21),l(25,"span"),c(26,"Charging Slots"),d()(),l(27,"span",20),c(28),d()()(),l(29,"span",22),c(30),d()()()),a&2){let t=r.$implicit,e=ze();p(5),_(t.name),p(3),b("color",t.status?"primary":"warn"),p(),_(t.status?"check_circle":"cancel"),p(2),_(t.status?"Online":"Offline"),p(9),b("ngClass",e.getMachineStatus(t.bin_level).cssClass),p(),M(" ",e.getMachineStatus(t.bin_level).label," "),p(6),b("ngClass",He(10,yt,e.getChargerUsage(t)<50,e.getChargerUsage(t)>=50&&e.getChargerUsage(t)<=90,e.getChargerUsage(t)>90)),p(),I(" ",t.available_charging_slots," / ",t.charging_slots," available "),p(2),M("Last updated ",t.last_modified,"")}}var ce=class a{constructor(r){this.adminService=r}data;machines;barChartPlugins=[];barChartData;barChartOptions={responsive:!0,maintainAspectRatio:!1};ngOnInit(){this.adminService.getDashboard(oe()).subscribe(r=>{this.data=r}),this.adminService.getMonthlyContrib(T()).subscribe(r=>{let t={};r.forEach(n=>{let i=`${n.month}`;t[i]=(t[i]||0)+(n.bottles||0)});let e=Object.keys(t).map(n=>{let i=parseInt(n,10)-1;return Z[i]??n});this.barChartData={labels:e,datasets:[{data:Object.values(t),label:"Bottles",backgroundColor:["#10B981"]}]}}),this.adminService.getMachines().subscribe(r=>{this.machines=r})}getMachineStatus(r){return r>=100?{label:"FULL",cssClass:"red-pill"}:r<60?{label:"LOW",cssClass:"green-pill"}:{label:"ALMOST FULL",cssClass:"warning-pill"}}getChargerUsage(r){return r.charging_slots||r.charging_slots===0?0:Math.round(r.available_charging_slots/r.charging_slots*100)}static \u0275fac=function(t){return new(t||a)(k(de))};static \u0275cmp=C({type:a,selectors:[["app-admin-dashboard"]],standalone:!0,features:[S],decls:34,vars:8,consts:[["fxFlexFill","","fxLayout","column",1,"background-color"],["fxLayout","column","fxLayoutGap","24",1,"padding-16","background-color"],["fxFlex","","fxLayout.xs","column","fxLayout.gt-xs","row","fxLayoutGap","24"],["fxFlex",""],["mat-card-avatar","",1,"icon-image","bottle"],["mat-card-avatar","",1,"icon-image","person"],["mat-card-avatar","",1,"icon-image","redeem"],[1,"horizontal-padding","padding-bottom-14"],["fxFlex","","appearance","outlined"],[1,"horizontal-padding"],[1,"chart"],["baseChart","",3,"data","options","plugins","legend","type"],[1,"background-color","padding-bottom-14"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","4"],[3,"color"],["fxLayout","column","fxLayoutGap","24",1,"padding-top-14"],["fxFlex","","fxLayout.xs","column","fxLayout.gt-xs","row","fxLayoutGap","34"],["fxFlex","","fxLayout","column","fxLayoutGap","14"],["fxFlex","","fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","4"],["svgIcon","bin"],[3,"ngClass"],["svgIcon","redeem"],["fxFlex","","fxLayoutAlign","center",1,"secondary-text"]],template:function(t,e){t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-header"),g(5,"div",4),l(6,"mat-card-subtitle"),c(7,"Total Bottles"),d(),l(8,"mat-card-title"),c(9),d()()(),l(10,"mat-card",3)(11,"mat-card-header"),g(12,"div",5),l(13,"mat-card-subtitle"),c(14,"Active Students"),d(),l(15,"mat-card-title"),c(16),d()()(),l(17,"mat-card",3)(18,"mat-card-header"),g(19,"div",6),l(20,"mat-card-subtitle"),c(21,"Total Redemptions"),d(),l(22,"mat-card-title"),c(23),d()()()(),l(24,"mat-card",7)(25,"h3"),c(26,"Machine Status"),d(),Ne(27,Ct,31,14,"mat-card",8,Ge),d(),l(29,"mat-card")(30,"h3",9),c(31,"Collection Trends"),d(),l(32,"mat-card-content",10),g(33,"canvas",11),d()()()()),t&2&&(p(9),_(e.data==null?null:e.data.total_bottles),p(7),_(e.data==null?null:e.data.total_active_students),p(7),_(e.data==null?null:e.data.total_redemptions),p(4),We(e.machines),p(6),b("data",e.barChartData)("options",e.barChartOptions)("plugins",e.barChartPlugins)("legend",!1)("type","bar"))},dependencies:[N,G,B,R,A,F,Je,q,Y,W,U,j,$,H,z,J,X,V,K,Q,le,Qe],styles:['[_nghost-%COMP%]{height:100%}.icon-image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background-repeat:no-repeat;background-position:center;background-size:50%}.person[_ngcontent-%COMP%]{background-image:url("./media/person-I2AGMY25.svg");background-color:#dbeafe}.bottle[_ngcontent-%COMP%]{background-image:url("./media/water-bottle-W5XN6HUO.svg");background-color:#f0fdf4}.redeem[_ngcontent-%COMP%]{background-image:url("./media/redeem-violet-BJDFQGEO.svg");background-color:#faf5ff;color:#9333ea}#recycling-impact[_ngcontent-%COMP%]{background-color:#f0fdf4}#recycling-impact[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#16a34a}#waste-reduction[_ngcontent-%COMP%]{background-color:#dbeafe}#waste-reduction[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#2563eb}#flood-prevention[_ngcontent-%COMP%]{background-color:#faf5ff}#flood-prevention[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#9333ea}.primary[_ngcontent-%COMP%]{font-size:24px;font-weight:700}.chart[_ngcontent-%COMP%]{flex:1;height:100%}.center[_ngcontent-%COMP%]{height:100%}  .mat-mdc-progress-bar{height:12px!important;border-radius:8px}#redeem-btn[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;width:100%}']})};var lt=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var a=window.screen;if(a)return(a.deviceXDPI||1)/(a.logicalXDPI||1)}return 1}(),te={toTextLines:function(a){var r=[],t;for(a=[].concat(a);a.length;)t=a.pop(),typeof t=="string"?r.unshift.apply(r,t.split(`
`)):Array.isArray(t)?a.push.apply(a,t):w(a)||r.unshift(""+t);return r},textSize:function(a,r,t){var e=[].concat(r),n=e.length,i=a.font,o=0,s;for(a.font=t.string,s=0;s<n;++s)o=Math.max(a.measureText(e[s]).width,o);return a.font=i,{height:n*t.lineHeight,width:o}},bound:function(a,r,t){return Math.max(a,Math.min(r,t))},arrayDiff:function(a,r){var t=a.slice(),e=[],n,i,o,s;for(n=0,o=r.length;n<o;++n)s=r[n],i=t.indexOf(s),i===-1?e.push([s,1]):t.splice(i,1);for(n=0,o=t.length;n<o;++n)e.push([t[n],-1]);return e},rasterize:function(a){return Math.round(a*lt)/lt}};function we(a,r){var t=r.x,e=r.y;if(t===null)return{x:0,y:-1};if(e===null)return{x:1,y:0};var n=a.x-t,i=a.y-e,o=Math.sqrt(n*n+i*i);return{x:o?n/o:0,y:o?i/o:-1}}function Mt(a,r,t,e,n){switch(n){case"center":t=e=0;break;case"bottom":t=0,e=1;break;case"right":t=1,e=0;break;case"left":t=-1,e=0;break;case"top":t=0,e=-1;break;case"start":t=-t,e=-e;break;case"end":break;default:n*=Math.PI/180,t=Math.cos(n),e=Math.sin(n);break}return{x:a,y:r,vx:t,vy:e}}var St=0,dt=1,ct=2,mt=4,ut=8;function pe(a,r,t){var e=St;return a<t.left?e|=dt:a>t.right&&(e|=ct),r<t.top?e|=ut:r>t.bottom&&(e|=mt),e}function Et(a,r){for(var t=a.x0,e=a.y0,n=a.x1,i=a.y1,o=pe(t,e,r),s=pe(n,i,r),m,u,f;!(!(o|s)||o&s);)m=o||s,m&ut?(u=t+(n-t)*(r.top-e)/(i-e),f=r.top):m&mt?(u=t+(n-t)*(r.bottom-e)/(i-e),f=r.bottom):m&ct?(f=e+(i-e)*(r.right-t)/(n-t),u=r.right):m&dt&&(f=e+(i-e)*(r.left-t)/(n-t),u=r.left),m===o?(t=u,e=f,o=pe(t,e,r)):(n=u,i=f,s=pe(n,i,r));return{x0:t,x1:n,y0:e,y1:i}}function fe(a,r){var t=r.anchor,e=a,n,i;return r.clamp&&(e=Et(e,r.area)),t==="start"?(n=e.x0,i=e.y0):t==="end"?(n=e.x1,i=e.y1):(n=(e.x0+e.x1)/2,i=(e.y0+e.y1)/2),Mt(n,i,a.vx,a.vy,r.align)}var ge={arc:function(a,r){var t=(a.startAngle+a.endAngle)/2,e=Math.cos(t),n=Math.sin(t),i=a.innerRadius,o=a.outerRadius;return fe({x0:a.x+e*i,y0:a.y+n*i,x1:a.x+e*o,y1:a.y+n*o,vx:e,vy:n},r)},point:function(a,r){var t=we(a,r.origin),e=t.x*a.options.radius,n=t.y*a.options.radius;return fe({x0:a.x-e,y0:a.y-n,x1:a.x+e,y1:a.y+n,vx:t.x,vy:t.y},r)},bar:function(a,r){var t=we(a,r.origin),e=a.x,n=a.y,i=0,o=0;return a.horizontal?(e=Math.min(a.x,a.base),i=Math.abs(a.base-a.x)):(n=Math.min(a.y,a.base),o=Math.abs(a.base-a.y)),fe({x0:e,y0:n+o,x1:e+i,y1:n,vx:t.x,vy:t.y},r)},fallback:function(a,r){var t=we(a,r.origin);return fe({x0:a.x,y0:a.y,x1:a.x+(a.width||0),y1:a.y+(a.height||0),vx:t.x,vy:t.y},r)}},E=te.rasterize;function Pt(a){var r=a.borderWidth||0,t=a.padding,e=a.size.height,n=a.size.width,i=-n/2,o=-e/2;return{frame:{x:i-t.left-r,y:o-t.top-r,w:n+t.width+r*2,h:e+t.height+r*2},text:{x:i,y:o,w:n,h:e}}}function wt(a,r){var t=r.chart.getDatasetMeta(r.datasetIndex).vScale;if(!t)return null;if(t.xCenter!==void 0&&t.yCenter!==void 0)return{x:t.xCenter,y:t.yCenter};var e=t.getBasePixel();return a.horizontal?{x:e,y:null}:{x:null,y:e}}function Dt(a){return a instanceof et?ge.arc:a instanceof tt?ge.point:a instanceof at?ge.bar:ge.fallback}function Ot(a,r,t,e,n,i){var o=Math.PI/2;if(i){var s=Math.min(i,n/2,e/2),m=r+s,u=t+s,f=r+e-s,v=t+n-s;a.moveTo(r,u),m<f&&u<v?(a.arc(m,u,s,-Math.PI,-o),a.arc(f,u,s,-o,0),a.arc(f,v,s,0,o),a.arc(m,v,s,o,Math.PI)):m<f?(a.moveTo(m,t),a.arc(f,u,s,-o,o),a.arc(m,u,s,o,Math.PI+o)):u<v?(a.arc(m,u,s,-Math.PI,0),a.arc(m,v,s,0,Math.PI)):a.arc(m,u,s,-Math.PI,Math.PI),a.closePath(),a.moveTo(r,t)}else a.rect(r,t,e,n)}function kt(a,r,t){var e=t.backgroundColor,n=t.borderColor,i=t.borderWidth;!e&&(!n||!i)||(a.beginPath(),Ot(a,E(r.x)+i/2,E(r.y)+i/2,E(r.w)-i,E(r.h)-i,t.borderRadius),a.closePath(),e&&(a.fillStyle=e,a.fill()),n&&i&&(a.strokeStyle=n,a.lineWidth=i,a.lineJoin="miter",a.stroke()))}function It(a,r,t){var e=t.lineHeight,n=a.w,i=a.x,o=a.y+e/2;return r==="center"?i+=n/2:(r==="end"||r==="right")&&(i+=n),{h:e,w:n,x:i,y:o}}function Lt(a,r,t){var e=a.shadowBlur,n=t.stroked,i=E(t.x),o=E(t.y),s=E(t.w);n&&a.strokeText(r,i,o,s),t.filled&&(e&&n&&(a.shadowBlur=0),a.fillText(r,i,o,s),e&&n&&(a.shadowBlur=e))}function Tt(a,r,t,e){var n=e.textAlign,i=e.color,o=!!i,s=e.font,m=r.length,u=e.textStrokeColor,f=e.textStrokeWidth,v=u&&f,y;if(!(!m||!o&&!v))for(t=It(t,n,s),a.font=s.string,a.textAlign=n,a.textBaseline="middle",a.shadowBlur=e.textShadowBlur,a.shadowColor=e.textShadowColor,o&&(a.fillStyle=i),v&&(a.lineJoin="round",a.lineWidth=f,a.strokeStyle=u),y=0,m=r.length;y<m;++y)Lt(a,r[y],{stroked:v,filled:o,w:t.w,x:t.x,y:t.y+t.h*y})}var pt=function(a,r,t,e){var n=this;n._config=a,n._index=e,n._model=null,n._rects=null,n._ctx=r,n._el=t};D(pt.prototype,{_modelize:function(a,r,t,e){var n=this,i=n._index,o=Pe(h([t.font,{}],e,i)),s=h([t.color,Ze.color],e,i);return{align:h([t.align,"center"],e,i),anchor:h([t.anchor,"center"],e,i),area:e.chart.chartArea,backgroundColor:h([t.backgroundColor,null],e,i),borderColor:h([t.borderColor,null],e,i),borderRadius:h([t.borderRadius,0],e,i),borderWidth:h([t.borderWidth,0],e,i),clamp:h([t.clamp,!1],e,i),clip:h([t.clip,!1],e,i),color:s,display:a,font:o,lines:r,offset:h([t.offset,4],e,i),opacity:h([t.opacity,1],e,i),origin:wt(n._el,e),padding:Ee(h([t.padding,4],e,i)),positioner:Dt(n._el),rotation:h([t.rotation,0],e,i)*(Math.PI/180),size:te.textSize(n._ctx,r,o),textAlign:h([t.textAlign,"start"],e,i),textShadowBlur:h([t.textShadowBlur,0],e,i),textShadowColor:h([t.textShadowColor,s],e,i),textStrokeColor:h([t.textStrokeColor,s],e,i),textStrokeWidth:h([t.textStrokeWidth,0],e,i)}},update:function(a){var r=this,t=null,e=null,n=r._index,i=r._config,o,s,m,u=h([i.display,!0],a,n);u&&(o=a.dataset.data[n],s=Me(se(i.formatter,[o,a]),o),m=w(s)?[]:te.toTextLines(s),m.length&&(t=r._modelize(u,m,i,a),e=Pt(t))),r._model=t,r._rects=e},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(a,r){var t=this,e=a.ctx,n=t._model,i=t._rects,o;this.visible()&&(e.save(),n.clip&&(o=n.area,e.beginPath(),e.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),e.clip()),e.globalAlpha=te.bound(0,n.opacity,1),e.translate(E(r.x),E(r.y)),e.rotate(n.rotation),kt(e,i.frame,n),Tt(e,n.lines,i.text,n),e.restore())}});var At=Number.MIN_SAFE_INTEGER||-9007199254740991,Ft=Number.MAX_SAFE_INTEGER||9007199254740991;function ee(a,r,t){var e=Math.cos(t),n=Math.sin(t),i=r.x,o=r.y;return{x:i+e*(a.x-i)-n*(a.y-o),y:o+n*(a.x-i)+e*(a.y-o)}}function st(a,r){var t=Ft,e=At,n=r.origin,i,o,s,m,u;for(i=0;i<a.length;++i)o=a[i],s=o.x-n.x,m=o.y-n.y,u=r.vx*s+r.vy*m,t=Math.min(t,u),e=Math.max(e,u);return{min:t,max:e}}function ve(a,r){var t=r.x-a.x,e=r.y-a.y,n=Math.sqrt(t*t+e*e);return{vx:(r.x-a.x)/n,vy:(r.y-a.y)/n,origin:a,ln:n}}var ft=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};D(ft.prototype,{center:function(){var a=this._rect;return{x:a.x+a.w/2,y:a.y+a.h/2}},update:function(a,r,t){this._rotation=t,this._rect={x:r.x+a.x,y:r.y+a.y,w:r.w,h:r.h}},contains:function(a){var r=this,t=1,e=r._rect;return a=ee(a,r.center(),-r._rotation),!(a.x<e.x-t||a.y<e.y-t||a.x>e.x+e.w+t*2||a.y>e.y+e.h+t*2)},intersects:function(a){var r=this._points(),t=a._points(),e=[ve(r[0],r[1]),ve(r[0],r[3])],n,i,o;for(this._rotation!==a._rotation&&e.push(ve(t[0],t[1]),ve(t[0],t[3])),n=0;n<e.length;++n)if(i=st(r,e[n]),o=st(t,e[n]),i.max<o.min||o.max<i.min)return!1;return!0},_points:function(){var a=this,r=a._rect,t=a._rotation,e=a.center();return[ee({x:r.x,y:r.y},e,t),ee({x:r.x+r.w,y:r.y},e,t),ee({x:r.x+r.w,y:r.y+r.h},e,t),ee({x:r.x,y:r.y+r.h},e,t)]}});function gt(a,r,t){var e=r.positioner(a,r),n=e.vx,i=e.vy;if(!n&&!i)return{x:e.x,y:e.y};var o=t.w,s=t.h,m=r.rotation,u=Math.abs(o/2*Math.cos(m))+Math.abs(s/2*Math.sin(m)),f=Math.abs(o/2*Math.sin(m))+Math.abs(s/2*Math.cos(m)),v=1/Math.max(Math.abs(n),Math.abs(i));return u*=n*v,f*=i*v,u+=r.offset*n,f+=r.offset*i,{x:e.x+u,y:e.y+f}}function Rt(a,r){var t,e,n,i;for(t=a.length-1;t>=0;--t)for(n=a[t].$layout,e=t-1;e>=0&&n._visible;--e)i=a[e].$layout,i._visible&&n._box.intersects(i._box)&&r(n,i);return a}function Bt(a){var r,t,e,n,i,o,s;for(r=0,t=a.length;r<t;++r)e=a[r],n=e.$layout,n._visible&&(s=new Proxy(e._el,{get:(m,u)=>m.getProps([u],!0)[u]}),i=e.geometry(),o=gt(s,e.model(),i),n._box.update(o,i,e.rotation()));return Rt(a,function(m,u){var f=m._hidable,v=u._hidable;f&&v||v?u._visible=!1:f&&(m._visible=!1)})}var ae={prepare:function(a){var r=[],t,e,n,i,o;for(t=0,n=a.length;t<n;++t)for(e=0,i=a[t].length;e<i;++e)o=a[t][e],r.push(o),o.$layout={_box:new ft,_hidable:!1,_visible:!0,_set:t,_idx:o._index};return r.sort(function(s,m){var u=s.$layout,f=m.$layout;return u._idx===f._idx?f._set-u._set:f._idx-u._idx}),this.update(r),r},update:function(a){var r=!1,t,e,n,i,o;for(t=0,e=a.length;t<e;++t)n=a[t],i=n.model(),o=n.$layout,o._hidable=i&&i.display==="auto",o._visible=n.visible(),r|=o._hidable;r&&Bt(a)},lookup:function(a,r){var t,e;for(t=a.length-1;t>=0;--t)if(e=a[t].$layout,e&&e._visible&&e._box.contains(r))return a[t];return null},draw:function(a,r){var t,e,n,i,o,s;for(t=0,e=r.length;t<e;++t)n=r[t],i=n.$layout,i._visible&&(o=n.geometry(),s=gt(n._el,n.model(),o),i._box.update(s,o,n.rotation()),n.draw(a,s))}},Gt=function(a){if(w(a))return null;var r=a,t,e,n;if(Ce(a))if(!w(a.label))r=a.label;else if(!w(a.r))r=a.r;else for(r="",t=Object.keys(a),n=0,e=t.length;n<e;++n)r+=(n!==0?", ":"")+t[n]+": "+a[t[n]];return""+r},Nt={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:Gt,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},x="$datalabels",vt="$default";function Wt(a,r){var t=a.datalabels,e={},n=[],i,o;return t===!1?null:(t===!0&&(t={}),r=D({},[r,t]),i=r.labels||{},o=Object.keys(i),delete r.labels,o.length?o.forEach(function(s){i[s]&&n.push(D({},[r,i[s],{_key:s}]))}):n.push(r),e=n.reduce(function(s,m){return Se(m.listeners||{},function(u,f){s[f]=s[f]||{},s[f][m._key||vt]=u}),delete m.listeners,s},{}),{labels:n,listeners:e})}function De(a,r,t,e){if(r){var n=t.$context,i=t.$groups,o;r[i._set]&&(o=r[i._set][i._key],o&&se(o,[n,e])===!0&&(a[x]._dirty=!0,t.update(n)))}}function zt(a,r,t,e,n){var i,o;!t&&!e||(t?e?t!==e&&(o=i=!0):o=!0:i=!0,o&&De(a,r.leave,t,n),i&&De(a,r.enter,e,n))}function jt(a,r){var t=a[x],e=t._listeners,n,i;if(!(!e.enter&&!e.leave)){if(r.type==="mousemove")i=ae.lookup(t._labels,r);else if(r.type!=="mouseout")return;n=t._hovered,t._hovered=i,zt(a,e,n,i,r)}}function Ht(a,r){var t=a[x],e=t._listeners.click,n=e&&ae.lookup(t._labels,r);n&&De(a,e,n,r)}var ht={id:"datalabels",defaults:Nt,beforeInit:function(a){a[x]={_actives:[]}},beforeUpdate:function(a){var r=a[x];r._listened=!1,r._listeners={},r._datasets=[],r._labels=[]},afterDatasetUpdate:function(a,r,t){var e=r.index,n=a[x],i=n._datasets[e]=[],o=a.isDatasetVisible(e),s=a.data.datasets[e],m=Wt(s,t),u=r.meta.data||[],f=a.ctx,v,y,Oe,ke,xe,Ie,O,P;for(f.save(),v=0,Oe=u.length;v<Oe;++v)if(O=u[v],O[x]=[],o&&O&&a.getDataVisibility(v)&&!O.skip)for(y=0,ke=m.labels.length;y<ke;++y)xe=m.labels[y],Ie=xe._key,P=new pt(xe,f,O,v),P.$groups={_set:e,_key:Ie||vt},P.$context={active:!1,chart:a,dataIndex:v,dataset:s,datasetIndex:e},P.update(P.$context),O[x].push(P),i.push(P);f.restore(),D(n._listeners,m.listeners,{merger:function(re,ye,_t){ye[re]=ye[re]||{},ye[re][r.index]=_t[re],n._listened=!0}})},afterUpdate:function(a){a[x]._labels=ae.prepare(a[x]._datasets)},afterDatasetsDraw:function(a){ae.draw(a,a[x]._labels)},beforeEvent:function(a,r){if(a[x]._listened){var t=r.event;switch(t.type){case"mousemove":case"mouseout":jt(a,t);break;case"click":Ht(a,t);break}}},afterEvent:function(a){var r=a[x],t=r._actives,e=r._actives=a.getActiveElements(),n=te.arrayDiff(t,e),i,o,s,m,u,f,v;for(i=0,o=n.length;i<o;++i)if(u=n[i],u[1])for(v=u[0].element[x]||[],s=0,m=v.length;s<m;++s)f=v[s],f.$context.active=u[1]===1,f.update(f.$context);(r._dirty||n.length)&&(ae.update(r._labels),a.render()),delete r._dirty}};var he=class a{constructor(r){this.studentService=r}data;barChartData;BOTTLES_PER_CHAIR=50;BOTTLES_PER_KG_WASTE=100;ENERGY_PER_BOTTLE=.0058;WASTE_TARGET_KG=2;ENERGY_TARGET_KWH=20;ngOnInit(){this.studentService.getStudent().subscribe(r=>{this.data=r;let t=r?.total_bottles||0;this.data.recycling_impact=Math.floor(t/this.BOTTLES_PER_CHAIR),this.data.waste_diverted=parseFloat((t/this.BOTTLES_PER_KG_WASTE).toFixed(2)),this.data.energy_saved=parseFloat((t/this.ENERGY_PER_BOTTLE).toFixed(2))}),this.studentService.getMonthlyContrib(T()).subscribe(r=>{let t=Object.keys(r).map(e=>{let n=parseInt(e,10)-1;return Z[n]??e});console.log(Object.values(r)),this.barChartData={labels:t,datasets:[{data:Object.values(r).map(e=>e.bottles),label:"Bottles",backgroundColor:["#10B981"]}]}})}doughnutChartLabels=["Waste (kg)","School Chairs","CO2 Reduction"];doughnutChartDatasets=[{data:[350,450,100],backgroundColor:["#3B82F6","#10B981","#6366F1"]}];doughnutChartOptions={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"top"},datalabels:{color:"#fff",formatter:(r,t)=>{let n=t.chart.data.datasets[0].data.reduce((o,s)=>o+s,0);return(r/n*100).toFixed(1)+"%"}}}};doughnutChartPlugins=[ht];barChartPlugins=[];barChartOptions={responsive:!0,maintainAspectRatio:!1};static \u0275fac=function(t){return new(t||a)(k(rt))};static \u0275cmp=C({type:a,selectors:[["app-student-dashboard"]],standalone:!0,features:[S],decls:104,vars:29,consts:[["fxFlexFill","","fxLayout","column",1,"background-color"],["fxLayout","column","fxLayoutGap","24",1,"padding-14","background-color"],["fxFlex","","fxLayout.xs","column","fxLayout.gt-xs","row","fxLayoutGap","24"],["fxFlex",""],["mat-card-avatar","",1,"icon-image","bottle"],["mode","determinate",3,"value"],[1,"secondary-text"],["mat-card-avatar","",1,"icon-image","redeem"],["mat-flat-button","","id","redeem-btn"],["fxLayout","column","fxLayoutGap","24",1,"padding-14"],["fxFlex","","fxLayout.xs","column","fxLayout.gt-xs","row","fxLayoutGap","24","fxLayoutGap","24"],["fxFlex","","id","recycling-impact","appearance","outlined"],["mat-card-avatar","","svgIcon","scale","color","primary",2,"width","32px","height","32px"],[1,"primary"],[1,"secondary-text",2,"text-align","start"],["fxFlex","","id","waste-reduction","appearance","outlined"],["mat-card-avatar","","svgIcon","water-droplet","color","primary",2,"width","32px","height","32px"],["fxFlex","","id","flood-prevention","appearance","outlined"],["mat-card-avatar","","svgIcon","leaf","color","primary",2,"width","32px","height","32px"],["fxFlex","","appearance","outlined",1,"center"],["fxFlex","","fxLayout","column","fxLayoutGap","14"],["fxLayout","row","fxFlex","","fxLayoutAlign","space-between center"],["color","accent","mode","determinate",3,"value"],["color","blue","mode","determinate",3,"value"],[1,"chart"],["baseChart","",3,"data","options","plugins","legend","type"]],template:function(t,e){t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-header"),g(5,"div",4),l(6,"mat-card-subtitle"),c(7,"Total Bottles Deposited"),d(),l(8,"mat-card-title"),c(9),d()(),l(10,"mat-card-content"),g(11,"mat-progress-bar",5),l(12,"p",6),c(13,"Great job! You've made a significant impact."),d()()(),l(14,"mat-card",3)(15,"mat-card-header"),g(16,"div",7),l(17,"mat-card-subtitle"),c(18,"Available Points"),d(),l(19,"mat-card-title"),c(20),d()(),l(21,"mat-card-content")(22,"button",8),c(23,"Redeem"),d(),l(24,"p",6),c(25,"1 point = 10 minutes of charging time"),d()()()(),l(26,"mat-card")(27,"div",9)(28,"h3"),c(29,"Your Environmental Impact"),d(),l(30,"div",10)(31,"mat-card",11)(32,"mat-card-header"),g(33,"mat-icon",12),l(34,"mat-card-title"),c(35,"Recycling Impact"),d()(),l(36,"mat-card-content")(37,"span",13),c(38),d(),l(39,"p"),c(40,"School chairs can be produced"),d(),l(41,"p",14),c(42,"50 bottles = 1 school chair"),d()()(),l(43,"mat-card",15)(44,"mat-card-header"),g(45,"mat-icon",16),l(46,"mat-card-title"),c(47,"Waste Reduction"),d()(),l(48,"mat-card-content")(49,"span",13),c(50),d(),l(51,"p"),c(52,"Plastic waste diverted"),d(),l(53,"p",14),c(54,"100 bottles = 2 kg of plastic waste"),d()()(),l(55,"mat-card",17)(56,"mat-card-header"),g(57,"mat-icon",18),l(58,"mat-card-title"),c(59,"Energy Saved"),d()(),l(60,"mat-card-content")(61,"span",13),c(62),d(),l(63,"p"),c(64,"Energy saved by recycling bottles"),d(),l(65,"p",14),c(66,"1 bottle = 0.0058 kWh"),d()()()(),l(67,"div",2)(68,"mat-card",19)(69,"mat-card-header")(70,"h3"),c(71,"Impact Summary"),d()(),l(72,"mat-card-content")(73,"div",20)(74,"div",20)(75,"div",21)(76,"span"),c(77,"School Chairs"),d(),l(78,"span"),c(79),ne(80,"number"),d()(),g(81,"mat-progress-bar",22),d(),l(82,"div",20)(83,"div",21)(84,"span"),c(85,"Waste Reduction"),d(),l(86,"span"),c(87),ne(88,"number"),d()(),g(89,"mat-progress-bar",23),d(),l(90,"div",20)(91,"div",21)(92,"span"),c(93,"Energy Saved"),d(),l(94,"span"),c(95),ne(96,"number"),d()(),g(97,"mat-progress-bar",22),d()()()(),l(98,"mat-card",19)(99,"mat-card-header")(100,"h3"),c(101,"Monthly Recycling"),d()(),l(102,"mat-card-content",24),g(103,"canvas",25),d()()()()()()()),t&2&&(p(9),_(e.data==null?null:e.data.total_bottles),p(2),b("value",e.data==null?null:e.data.total_bottles),p(9),_(e.data==null?null:e.data.available_points),p(18),_(e.data==null?null:e.data.recycling_impact),p(12),M("",e.data==null?null:e.data.waste_diverted," kg"),p(12),M("",e.data==null?null:e.data.energy_saved," kWh"),p(17),I("",ie(80,20,(e.data==null?null:e.data.recycling_impact)||0,"1.2-2"),"/",e.BOTTLES_PER_CHAIR,""),p(2),b("value",((e.data==null?null:e.data.recycling_impact)||0)/e.BOTTLES_PER_CHAIR*100),p(6),I("",ie(88,23,(e.data==null?null:e.data.waste_diverted)||0,"1.2-2"),"/",e.WASTE_TARGET_KG,"kg"),p(2),b("value",((e.data==null?null:e.data.waste_diverted)||0)/e.WASTE_TARGET_KG*100),p(6),I("",ie(96,26,(e.data==null?null:e.data.energy_saved)||0,"1.2-2"),"/",e.ENERGY_TARGET_KWH," kWh"),p(2),b("value",((e.data==null?null:e.data.energy_saved)||0)/e.ENERGY_TARGET_KWH*100),p(6),b("data",e.barChartData)("options",e.barChartOptions)("plugins",e.barChartPlugins)("legend",!1)("type","bar"))},dependencies:[L,Ke,N,G,B,R,A,F,q,Y,W,U,j,$,H,z,J,X,V,Ve,K,qe,Q],styles:['[_nghost-%COMP%]{height:100%}.icon-image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background-repeat:no-repeat;background-position:center;background-size:50%}.redeem[_ngcontent-%COMP%]{background-image:url("./media/redeem-blue-YE6MLK5H.svg");background-color:#dbeafe}.bottle[_ngcontent-%COMP%]{background-image:url("./media/water-bottle-W5XN6HUO.svg");background-color:#f0fdf4}#recycling-impact[_ngcontent-%COMP%]{background-color:#f0fdf4}#recycling-impact[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#16a34a}#waste-reduction[_ngcontent-%COMP%]{background-color:#dbeafe}#waste-reduction[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#2563eb}#flood-prevention[_ngcontent-%COMP%]{background-color:#faf5ff}#flood-prevention[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#9333ea}.primary[_ngcontent-%COMP%]{font-size:24px;font-weight:700}.chart[_ngcontent-%COMP%]{flex:1;height:100%}.doughnut[_ngcontent-%COMP%]{max-width:500px}.center[_ngcontent-%COMP%]{height:100%}  .mat-mdc-progress-bar{height:12px!important;border-radius:8px}#redeem-btn[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;width:100%}']})};var be=class a{progress=0;static \u0275fac=function(t){return new(t||a)};static \u0275cmp=C({type:a,selectors:[["app-progress-bar"]],inputs:{progress:"progress"},standalone:!0,features:[S],decls:4,vars:3,consts:[[1,"progress-container"],[1,"progress-bar"],[1,"progress-text"]],template:function(t,e){t&1&&(l(0,"div",0)(1,"div",1)(2,"span",2),c(3),d()()()),t&2&&(p(),Be("width",e.progress,"%"),p(2),M("",e.progress,"%"))},styles:[".progress-container[_ngcontent-%COMP%]{width:100%;height:30px;background-color:#e0e0e0;border-radius:15px;overflow:hidden;position:relative}.progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#4caf50;display:flex;align-items:center;justify-content:center;transition:width .3s ease-in-out;position:relative}.progress-text[_ngcontent-%COMP%]{position:absolute;width:100%;text-align:center;font-weight:700;color:#fff}"]})};var _e=class a{constructor(r){this.adminService=r}data={monthly_target:0,total_active_students:0,total_bottles:0,total_redemptions:0,total_bottles_collected_last_month:0};barChartPlugins=[];barChartData;barChartOptions={responsive:!0,maintainAspectRatio:!1};destroy$=new Le;ngOnInit(){this.adminService.getDashboard(oe()).pipe(Ae(r=>this.adminService.getDashboard(Xe()).pipe(Te(t=>({currentMonth:r,prevMonth:t})))),Fe(this.destroy$)).subscribe(({currentMonth:r,prevMonth:t})=>{this.data=r,this.data.total_bottles_collected_last_month=t?.total_bottles||0}),this.adminService.getMonthlyContrib(T()).subscribe(r=>{let t={};r.forEach(n=>{let i=`${n.month}`;t[i]=(t[i]||0)+(n.bottles||0)});let e=Object.keys(t).map(n=>{let i=parseInt(n,10)-1;return Z[i]??n});this.barChartData={labels:e,datasets:[{data:Object.values(t),label:"Bottles",backgroundColor:["#10B981"]}]}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get progressValue(){if(!this.data||!this.data.monthly_target)return 0;let r=this.data.total_bottles/this.data.monthly_target*100;return parseFloat(r.toFixed(2))}static \u0275fac=function(t){return new(t||a)(k(de))};static \u0275cmp=C({type:a,selectors:[["app-recycling-dashboard"]],standalone:!0,features:[S],decls:35,vars:9,consts:[["fxFlexFill","","fxLayout","column",1,"background-color"],["fxLayout","column","fxLayoutGap","24",1,"padding-16","background-color"],["fxFlex","","fxLayout.xs","column","fxLayout.gt-xs","row","fxLayoutGap","24"],["fxFlex",""],["mat-card-avatar","",1,"icon-image","bottle"],["fxFlex","","fxLayout","column","fxLayoutGap","14"],["fxLayoutAlign","start",1,"secondary-text"],[3,"progress"],["mat-card-avatar","",1,"icon-image","person"],["fxFlex","","fxLayoutGap","10","fxLayout","row","fxLayoutAlign","start center"],["svgIcon","scale","color","primary"],[1,"green-color"],[1,"horizontal-padding"],[1,"chart"],["baseChart","",3,"data","options","plugins","legend","type"]],template:function(t,e){t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-header"),g(5,"div",4),l(6,"mat-card-subtitle"),c(7,"Total Bottles Collected"),d(),l(8,"mat-card-title"),c(9),d()(),l(10,"mat-card-content")(11,"div",5)(12,"span",6),c(13,"Monthly Progress"),d(),g(14,"app-progress-bar",7),d()()(),l(15,"mat-card",3)(16,"mat-card-header"),g(17,"div",8),l(18,"mat-card-subtitle"),c(19,"Active Student Participants"),d(),l(20,"mat-card-title"),c(21),d()(),l(22,"mat-card-content")(23,"div",5)(24,"span",6),c(25,"Growth"),d(),l(26,"div",9),g(27,"mat-icon",10),l(28,"span",11),c(29),d()()()()()(),l(30,"mat-card")(31,"h3",12),c(32,"Collection Trends"),d(),l(33,"mat-card-content",13),g(34,"canvas",14),d()()()()),t&2&&(p(9),_(e.data.total_bottles),p(5),b("progress",e.progressValue),p(7),_(e.data.total_active_students),p(8),M("",(e.data.total_bottles-e.data.total_bottles_collected_last_month)/100*100,"% vs last month"),p(5),b("data",e.barChartData)("options",e.barChartOptions)("plugins",e.barChartPlugins)("legend",!1)("type","bar"))},dependencies:[L,N,G,B,R,A,F,q,Y,W,U,j,$,H,z,J,X,V,K,Q,le,be],styles:['[_nghost-%COMP%]{height:100%}.icon-image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background-repeat:no-repeat;background-position:center;background-size:50%}.person[_ngcontent-%COMP%]{background-image:url("./media/person-I2AGMY25.svg");background-color:#dbeafe}.bottle[_ngcontent-%COMP%]{background-image:url("./media/water-bottle-W5XN6HUO.svg");background-color:#f0fdf4}.redeem[_ngcontent-%COMP%]{background-image:url("./media/redeem-violet-BJDFQGEO.svg");background-color:#faf5ff;color:#9333ea}#recycling-impact[_ngcontent-%COMP%]{background-color:#f0fdf4}#recycling-impact[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#16a34a}#waste-reduction[_ngcontent-%COMP%]{background-color:#dbeafe}#waste-reduction[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#2563eb}#flood-prevention[_ngcontent-%COMP%]{background-color:#faf5ff}#flood-prevention[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#9333ea}.primary[_ngcontent-%COMP%]{font-size:24px;font-weight:700}.chart[_ngcontent-%COMP%]{flex:1;height:100%}.center[_ngcontent-%COMP%]{height:100%}  .mat-mdc-progress-bar{height:12px!important;border-radius:8px}#redeem-btn[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;width:100%}']})};function Ut(a,r){a&1&&g(0,"app-admin-dashboard",3)}function Yt(a,r){a&1&&g(0,"app-student-dashboard",3)}function Kt(a,r){a&1&&g(0,"app-recycling-dashboard",3)}function Xt(a,r){a&1&&(l(0,"div"),c(1,"Unknown role"),d())}var bt=class a{user;ngOnInit(){let r=localStorage.getItem("user_data");r&&(this.user=JSON.parse(r))}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=C({type:a,selectors:[["app-dashboard"]],standalone:!0,features:[je([]),S],decls:5,vars:4,consts:[["fxFlexFill","",1,"main-holder",3,"ngSwitch"],["fxFlex","",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["fxFlex",""]],template:function(t,e){t&1&&(l(0,"div",0),Re(1,Ut,1,0,"app-admin-dashboard",1)(2,Yt,1,0,"app-student-dashboard",1)(3,Kt,1,0,"app-recycling-dashboard",1)(4,Xt,2,0,"div",2),d()),t&2&&(b("ngSwitch",e.user==null?null:e.user.role),p(),b("ngSwitchCase","admin"),p(),b("ngSwitchCase","student"),p(),b("ngSwitchCase","recycling"))},dependencies:[L,$e,Ue,Ye,ce,he,_e],styles:["[_nghost-%COMP%]{height:100%}.main-holder[_ngcontent-%COMP%]{height:100%}"]})};export{bt as DashboardComponent};
