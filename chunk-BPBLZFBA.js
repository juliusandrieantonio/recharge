import{b as U,d as _,e as j}from"./chunk-YLQEISCQ.js";import{$ as d,Ac as c,Bc as y,Cc as f,Dc as s,Ec as i,Fc as v,Gc as m,Hc as E,W as p,d as a,k as w,uc as l,vc as h,wc as b,yc as g}from"./chunk-KD3HKJA5.js";var A=class u{constructor(e){this.auth=e;c(this.auth,r=>{this.currentUserSubject.next(r),this.initialized=!0})}currentUserSubject=new w(null);user$=this.currentUserSubject.asObservable();initialized=!1;login(e,r){return l(this.auth,h).then(()=>y(this.auth,e,r))}logout(){return f(this.auth)}get currentUser(){return this.currentUserSubject.value}isLoggedIn(){return!!this.currentUserSubject.value}waitForAuthInit(){return a(this,null,function*(){return new Promise(e=>{let r=c(this.auth,t=>{e(t),r()})})})}register(e){return a(this,null,function*(){try{let r=yield l(this.auth,h).then(()=>g(this.auth,e.email||"",e.password)),t=r.user,n=m();try{yield i(s(n,`phone_numbers/${e.phone_number}`),e.email),yield i(s(n,`users/${t.uid}`),{email:e.email,phone_number:e.phone_number,role:e.role,status:e.status,total_bottles:0,available_points:0}),yield i(s(n,`monthly_progress_by_user/${t.uid}/${_()}/${j()}`),{bottles:0})}catch{throw yield t.delete(),new Error("phone-already-in-use")}try{yield E(s(n,`dashboard_stats/${U()}/total_active_students`),o=>(o||0)+1)}catch(o){throw console.log(o),new Error}return r}catch(r){let t=r;switch(console.log(t),t.code||r.message){case"auth/email-already-in-use":throw new Error("email-already-in-use");case"auth/weak-password":throw new Error("weak-password");case"auth/invalid-email":throw new Error("invalid-email");case"phone-already-in-use":throw new Error("phone-already-in-use");default:throw new Error("registration-failed")}}})}getEmailByPhone(e){return a(this,null,function*(){try{let r=m(),t=yield v(s(r,`phone_numbers/${e}`));return t.exists()?t.val():null}catch(r){return console.error("Error fetching email by phone:",r),null}})}static \u0275fac=function(r){return new(r||u)(d(b))};static \u0275prov=p({token:u,factory:u.\u0275fac,providedIn:"root"})};export{A as a};
